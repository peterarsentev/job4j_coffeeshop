# Система заказов в кофейне

# Контекст

Предположим, что у нас есть кофейня и она принимает заказы, используя CRM систему. Попадая в систему заказ может пройти следующие стадии:

- Заказ зарегистрирован
- Заказ принят в работу
- Заказ отменен
- Заказ готов к выдаче
- Заказ выдан

Переход заказа в каждую из стадий сопровождается генерацией соответствующего события. Система устроена таким образом, что заказ хранится в базе в виде цепочки событий (см. event sourcing). Причины по котором был выбран такой подход - гибкость в плане дальнейшего разбиения заказа на этапы, что, например, необходимо для анализа трудозатрат и выявления проблем в скорости обслуживания клиентов.

## События

Приводим список событий и набор данных, которые они должны в себе содержать.

### Заказ зарегистрирован

- Идентификатор заказа
- Идентификатор клиента
- Идентификтор сотрудника
- Ожидаемое время выдачи
- Идентфикатор товара
- Стоимость товара
- Дата и время

### Заказ отменен

- Идентификатор заказа
- Идентификтор сотрудника
- Причина отмены заказа
- Дата и время

### Заказ взят в работу

- Идентификатор заказа
- Идентификтор сотрудника
- Дата и время

### Заказ готов к выдаче

- Идентификатор заказа
- Идентификтор сотрудника
- Дата и время

### Заказ выдан

- Идентификатор заказа
- Идентификтор сотрудника
- Дата и время

# Задача

## Обработка событий

Необходимо реализовать обработку событий. В первую очередь нужно выполнить проверку условий:

- Любому из событий должно предшествовать событие регистрации заказа
- Если заказ уже выдан или отменен, то публикация новых событий недоступна

Требование к БД - она должна быть реляционной.

## Получение информации по заказу

Необходимо реализовать получение полной информации по заказу на основе агрегации имеющихся по нему событий. В частности в модели должен быть отражен текущий статус (этап) заказа и присутствовать список событий с информацией о типе событий и времени его создания.

### Интерфейс для имплементации

interface OrderService {

   void publishEvent(OrderEvent event);

   Order findOrder(int id);

}
